<!DOCTYPE html>
<html>
<title>
    Orders details
</title>
<head>
  
  <style>
    .stars{
      display: flex;
    }
    .stars a{
      opacity : 50%;
      cursor: pointer;
      padding: 3px;
    }
    .stars:hover a{
      opacity: 100%;
    }
    .stars a:hover{
      opacity:100;
    }
    .stars a:hover ~a{
      opacity: 50%;
    }
    .stars a.active{
      opacity: 100%;
    }
    
    .stars.disabled{
      pointer-events: none;
    }
    
    </style>
    <style>
      body{
        background-color: #f5f5f5b6;
      }
      /* Styling for the modal window */
      .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0,0,0,0.4);
      }
      
      /* Styling for the modal content */
      .modal-content {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 1400px;
        height: 80%;
        overflow: auto;
      }
      
      /* Styling for the close button */
      .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
      }
      
      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

        .card-container {
  display: flex;
  justify-content: center;
  padding: 20px;
  width:70%;
}

.supply-card {
  width:100%;
  display: flex;
  align-items: center;
  background-color: #f0f0f0;
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  padding: 20px;
}

.image-section {
  flex: 0 0 auto;
  margin-left: 5%;
}

.details-section {
  flex: 1 1 auto;
  margin-left: 20%;
}

h2 {
  margin-bottom: 20px;
  color: #333;
}

ul {
  list-style-type: none;
  padding: 0;
  margin: 0;
}

li {
  margin-bottom: 15px;
}

h3 {
  color: #666;
  font-size: 16px;
  margin-bottom: 5px;
}

p {
  font-size: 16px;
  margin-left: 10px;
}

button {
  background-color: #4caf50;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  font-size: 16px;
  cursor: pointer;
}

button:hover {
  background-color: #45a049;
}

  </style>
    
    <div><!-- top-first navBar --->
        <nav class="topnav">
  
          <div class="logo">
            <img src =  "./img/home/RunTime_logo.png"/>
          </div>
          
          <ul class="nav-links">
            
            <div class="menu">
              <li><a href="/">Home</a></li>
              
              <li><a href="/">About</a></li>
              
              <li><a href="account.html" id="account">Account</a></li>
              
              <li><a href="#" id="cartLink">Cart</a></li>
            </div>
          
          </ul>
        </nav>
      </div>
</head>

<body>
    <main>

      <div class="card-container">
        <div class="supply-card">
          <section class="image-section">
            <img id="product-img" alt="Product Image">
          </section>
      
          <section class="details-section">
            <h2>Order Details</h2>
            <ul>
              <li>
                <h3>Product Name:</h3>
                <p id="product-name">Wits Flowers</p>
              </li>
              <li>
                <h3>Product Price:</h3>
                <p id="product-price">R25 000</p>
              </li>
              <li>
                <h3>Date of Purchase:</h3>
                <p id="product-date">14/05/2023</p>
              </li>
              <li>
                <h3>Payment Type:</h3>
                <p id="product-pay-type">Card payment</p>
              </li>
              <li>
                <h3>Product Description:</h3>
                <p id="product-desc">Fast phone</p>
              </li>
              <li>
                <h3>Product Quantity:</h3>
                <p id="product-quantity">10</p>
              </li>
              <li>
                <h3>Product Delivery Type:</h3>
                <p id="product-delivery">Shipping</p>
              </li>
            </ul>
            <button id="write-review-btn">Write a Review</button>
          </section>
        </div>
      </div>
      
          
          <!-- Review dialog -->
          <div id="review-dialog" class="modal">
          <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Write a Review</h2>
            <form>
            <label for="name">Review Title:</label>
            <input type="text" id="Review Title" name="Review Title" placeholder="Good, bad ,excellent..."><br>
          
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" placeholder="will auto fill if logged in" readonly><br>
            
            <label for="date">Date:</label>
            <input type="text" id="date" name="date" readonly><br>
  
            <label for="rating">Rating:</label>
            <div class="stars">
              <a>★</a>
              <a>★</a>
              <a>★</a>
              <a>★</a>
              <a>★</a>
            </div>
          
            <label for="review">Review:</label>
            <textarea id="review" name="review"></textarea><br>
          
            <button type="submit">Submit</button>
            </form>
          </div>
          </div>
        
        </div>
      </section>

		</section>
	</main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/7.14.1-0/firebase.js"></script>
	<script src="order_details.js"></script>
  <script>
    const product_local=localStorage.getItem("id");
		//  Get the write review button element
		const writeReviewBtn = document.getElementById("write-review-btn");
	  
		// Get the dialog element
		const dialog = document.getElementById("review-dialog");
	  
		// Get the close button element inside the dialog
		const closeBtn = dialog.querySelector(".close");
	
		// Get the current date and format it as yyyy-mm-dd
		const currentDate = new Date().toISOString().slice(0, 10);

		// Set the value of the date input to the current date
		 const date=document.getElementById("date").value = currentDate;
		//set email value to user email by default

		const emailreview=document.getElementById("email").value=user;

    console.log(i);
		 // Get the submit button element inside the dialog
		 const submitBtn = dialog.querySelector("button[type='submit']");

		// Add a click event listener to the write review button
		writeReviewBtn.addEventListener("click", () => {
		  // Display the dialog
		  dialog.style.display = "block";
		});
	  
		// Add a click event listener to the close button inside the dialog
		closeBtn.addEventListener("click", () => {
		  // Hide the dialog
		  dialog.style.display = "none";
		});
		
	  let ratings=0;
		var contactFormDB1 = firebase.database().ref('Reviews');
		const starWrapper=document.querySelector(".stars");
		const stars=document.querySelectorAll(".stars a");
		stars.forEach((star, clickedIdx) => {
  		star.addEventListener("click", () => {
    	starWrapper.classList.add("disabled");
    	stars.forEach((otherStar, otherIdx) => {
      	if (otherIdx <= clickedIdx) {
        	otherStar.classList.add("active");
      	}
    	});
		 rating=clickedIdx+1;
		supplir_emailRef.once('value')
  		.then(snapshot => {
    	supplierEmail = snapshot.val();
		submitBtn.addEventListener("click", (event) => {
    	event.preventDefault(); // prevent default form submission behavior
		
		// Get the values of all fields
		const reviewTitle = document.getElementById("Review Title").value;
		const customerEmail = emailreview;
		const reviewDate = date;
		const numStars = rating;
		const reviewText = document.getElementById("review").value;
		const se=supplierEmail;
    const pname=nname;
		const product=product_local; // set product id value
		console.log(nname);
    console.log(product_local);//produdct id
		console.log(se);//supplier email
		console.log(rating)//num stars
		console.log(customerEmail)//user email
		console.log(reviewTitle)//review title
		console.log(reviewText)// review textbox
		console.log(reviewDate)//date
		// Push the data to Firebase
    if (reviewTitle &&  reviewText && rating !==0) {
      pushMessages(customerEmail,
                reviewDate,
                numStars,
                reviewText,
                reviewTitle,
                se,
                product
              );
              alert("Your review has been successfully submitted.");
    }
          else {
             
             alert("Please fill in all required fields"); // Show notification
              
            }

		// Reset the form fields
		document.getElementById("Review Title").value = "";
		emailreview.value = user;
		date.value = currentDate;
		stars.forEach((star) => {
		star.classList.remove("active");
		});
		starWrapper.classList.remove("disabled");
		rating = 0;
		document.getElementById("review").value = "";

		// Hide the dialog
		dialog.style.display = "none";
	});
			})
			});
		});
			// Add a click event listener to the submit button inside the dialog

		const pushMessages = (emailreview, date, rating, reviewText, reviewTitle, supplierEmail, product) => {
		const newContactForm = contactFormDB1.push();
		newContactForm.set({
			customer_email: emailreview,
			date: date,
			num_of_stars: rating,
			product_id: product,
			review: reviewText,
			review_title: reviewTitle,
			supplier_email: supplierEmail
		});
		};
	  </script>
</body>

</html>


<style>
    /* TOP-NAVBAR STYLING STARTS */
  
    .topnav {
  
  display: flex;
  
  align-items: center;
  
  justify-content: space-between;
  
  padding: 20px;
  border-bottom: #000000;
  
  background-color: rgb(255, 255, 255);
  
  color: #000000;
  
  }
  /* LOGO */ 
  img{
    height: 115px;
    width: 300px;
    padding: 0px;
  }
  .menu {
  
  display: flex;
  
  gap: 1em;
  
  font-size: 18px;
  
  }
  
  .menu li:hover {
  
  background-color: #4c9e9e;
  
  border-radius: 5px;
  
  transition: 0.3s ease;
  
  }
  
  .menu li {
  
  padding: 5px 14px;
  
  }

  main {
	display: flex;
	flex-wrap: wrap;
	padding: 20px;
  justify-content: center;
}

section {
	flex: 1;
	margin-right: 20px;
	margin-bottom: 20px;
}

section:last-child {
	margin-right: 0;
}

img {
	max-width: 100%;
}

h1, h2, h3 {
	margin-top: 0;
}

button {
	background-color: #333;
	color: #fff;
	border: none;
	padding: 10px 20px;
	cursor: pointer;
}

button:hover {
	background-color: #666;
}

form {
	margin-top: 20px;
}

form label, form input, form textarea {
	display: block;
	margin-bottom: 10px;
}

form textarea {
	height: 100px;
}

form button {
	margin-top: 10px;
}
#product-img {
	width: 400px; /* increase image width */
  height: auto; /* adjust height automatically */
  /* add any additional styling you want here */
}

  </style>
  	